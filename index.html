<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Колесо фортуны</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --border-color: #dcdcdc;
            --bg-light: #f8f9fa;
            --text-color: #333;
            --button-start-bg: #3498db;
            --button-start-hover-bg: #2980b9;
            --button-reset-bg: #e0e0e0;
            --button-reset-hover-bg: #cccccc;
            --pointer-color: #e74c3c;
            --spin-duration: 7000; /* Длительность в миллисекундах */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            color: var(--text-color);
            background-color: #fff;
            user-select: none;
            overflow-x: hidden;
        }
        
        .page-wrapper {
            display: flex;
            justify-content: center;
            padding: 20px;
            gap: 20px;
        }

        .banners-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 180px;
            flex-shrink: 0;
            transition: opacity 0.4s, width 0.4s, margin 0.4s, padding 0.4s;
            overflow: hidden; 
        }
        
        .banners-section.hidden {
            opacity: 0;
            width: 0;
            margin-right: 0;
            padding-right: 0;
        }

        .banner-placeholder {
            width: 100%;
            height: 250px;
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 14px;
            color: #999;
            text-align: center;
            padding: 10px;
        }

        .main-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 600px;
            width: 100%;
        }

        .main-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        .main-header h1 {
            font-size: 28px;
            font-weight: 700;
        }

        .header-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }
        
        .header-buttons button:first-child {
            background-color: var(--button-start-bg);
            color: white;
            margin-right: 10px;
        }
        .header-buttons button:first-child:hover {
            background-color: var(--button-start-hover-bg);
        }
        .header-buttons button:last-child {
            background-color: var(--button-reset-bg);
            color: var(--text-color);
        }
        .header-buttons button:last-child:hover {
            background-color: var(--button-reset-hover-bg);
        }

        .wheel-wrapper {
            position: relative;
            width: 500px;
            height: 500px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 5px solid #ccc;
        }

        .wheel-labels {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 4;
        }
        
        .wheel-labels span {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: 500;
            color: var(--text-color);
            text-shadow: 0 0 2px white;
            white-space: nowrap;
            text-align: center;
        }
        
        .wheel-labels span.winner-highlight {
            font-weight: 700;
            color: #000;
            animation: winner-glow 1.5s ease-in-out infinite alternate;
        }

        @keyframes winner-glow {
            from {
                text-shadow: 0 0 5px #fff, 0 0 10px #ffdd00, 0 0 15px #ffdd00;
            }
            to {
                text-shadow: 0 0 10px #fff, 0 0 20px #ffdd00, 0 0 30px #ffdd00;
            }
        }


        .pointer {
            position: absolute;
            width: 0;
            height: 0;
            border-top: 12px solid transparent;
            border-bottom: 12px solid transparent;
            border-right: 24px solid var(--pointer-color);
            left: 100%;
            margin-left: -4px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            filter: drop-shadow(-2px 2px 2px rgba(0, 0, 0, 0.25));
        }

        .description-text {
            line-height: 1.6;
            font-size: 15px;
            color: #555;
            padding: 15px;
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 5px;
        }

        .controls-section {
            width: 300px;
            flex-shrink: 0;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 20px;
            background-color: var(--bg-light);
            height: fit-content;
        }

        .textarea-container {
            position: relative;
            width: 100%;
            height: 250px;
            margin-bottom: 20px;
        }

        #prize-input, #prize-display {
            width: 100%;
            height: 100%;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 10px;
            font-size: 16px;
            font-family: 'Roboto', sans-serif;
            line-height: 1.5;
            box-sizing: border-box;
            position: absolute;
            top: 0;
            left: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        #prize-input {
            z-index: 2;
            resize: none;
            overflow-y: auto;
            color: transparent;
            background-color: transparent;
            caret-color: black;
        }
        
        #prize-input:focus {
            color: var(--text-color);
            background-color: #fff;
        }

        #prize-display {
            z-index: 1;
            background-color: #fff;
            color: var(--text-color);
        }
        
        .shortcuts {
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }

        .shortcuts p {
            font-weight: 500;
            margin-bottom: 10px;
        }
        
        .shortcuts code {
            display: inline-block;
            background-color: #fff;
            border: 1px solid #ccc;
            padding: 2px 8px;
            border-radius: 3px;
            font-weight: bold;
            margin-right: 5px;
            min-width: 25px;
            text-align: center;
        }

        .shortcuts li {
            list-style: none;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
        }

        #winner-banner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #d4edda;
            color: #155724;
            padding: 10px 20px;
            text-align: center;
            font-size: 20px;
            font-weight: 700;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            transform: translateY(-100%);
            transition: transform 0.3s ease-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        #winner-banner.show {
            transform: translateY(0);
        }

        #winner-banner .close-btn,
        #winner-banner .hide-element-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #155724;
            padding: 0 5px;
        }
        #winner-banner .hide-element-btn {
            font-size: 16px;
            font-weight: 500;
            padding: 5px 10px;
            border: 1px solid #155724;
            border-radius: 3px;
            background-color: #c3e6cb;
            transition: background-color 0.2s;
        }
        #winner-banner .hide-element-btn:hover {
            background-color: #b1dfbb;
        }

        @media (max-width: 1200px) {
            .page-wrapper {
                flex-direction: column;
                align-items: center;
            }
            .banners-section {
                flex-direction: row;
                width: 100%;
                justify-content: center;
            }
            .banner-placeholder {
                width: 180px;
                height: 250px;
            }
            .controls-section {
                width: 100%;
                max-width: 600px;
            }
            .banners-section.hidden {
                display: none;
            }
        }
        @media (max-width: 680px) {
             .wheel-wrapper {
                width: 90vw;
                height: 90vw;
             }
             .main-header {
                 flex-direction: column;
                 gap: 15px;
             }
             .banners-section {
                 display: none;
             }
        }
    </style>
</head>
<body>

    <div id="winner-banner">
        <button class="close-btn" id="winner-close-btn">X</button>
        <span id="winner-text"></span>
        <button class="hide-element-btn" id="winner-hide-btn">S</button>
    </div>

    <div class="page-wrapper">
        <div class="banners-section" id="banners-section">
            <div class="banner-placeholder">Здесь могла быть ваша реклама</div>
            <div class="banner-placeholder">Рекламный блок</div>
        </div>

        <div class="main-section">
            <div class="main-header">
                <h1>Колесо фортуны</h1>
                <div class="header-buttons">
                    <button id="start-btn">Старт</button>
                    <button id="reset-btn">Сбросить</button>
                </div>
            </div>
            <div class="wheel-wrapper">
                <div class="wheel" id="wheel"></div>
                <div class="wheel-labels" id="wheel-labels"></div>
                <div class="pointer" id="pointer"></div>
            </div>
            <div class="description-text">
                <p>Это онлайн-инструмент для случайного выбора названия или предмета. Его также называют выборщиком случайных имён, колесом имён или онлайн-рулеткой. Иногда людям сложно принимать решения. Затем составьте список существующих вариантов или кандидатов, а затем случайным образом выберите один из них. В этом случае вы можете использовать наш инструмент для принятия решений. Просто и весело. Вы можете изменить имена в текстовом поле, поместив одно имя в строку.</p>
            </div>
        </div>

        <div class="controls-section">
            <div class="textarea-container">
                <div id="prize-display"></div>
                <textarea id="prize-input" rows="10" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">30 tasks.
0 tasks</textarea>
            </div>
            
            <div class="shortcuts">
                <p>Горячие клавиши:</p>
                <ul>
                    <li><code>SPACE</code> покрутите</li>
                    <li><code>X</code> закрыть баннер</li>
                    <li><code>S</code> скрыть выбранный элемент</li>
                    <li><code>R</code> Сбросить</li>
                    <li><code>E</code> Изменить</li>
                    <li><code>F</code> Во весь экран</li>
                </ul>
            </div>
        </div>
    </div>
    
    <audio id="tick-sound-template" src="spin.mp3" preload="auto"></audio>
    <audio id="win-sound" src="win.mp3" preload="auto"></audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const wheel = document.getElementById('wheel');
            const wheelLabels = document.getElementById('wheel-labels');
            const pointer = document.getElementById('pointer');
            const startBtn = document.getElementById('start-btn');
            const resetBtn = document.getElementById('reset-btn');
            const prizeInput = document.getElementById('prize-input');
            const prizeDisplay = document.getElementById('prize-display');
            const winSound = document.getElementById('win-sound');
            const bannersSection = document.getElementById('banners-section');
            const winnerBanner = document.getElementById('winner-banner');
            const winnerText = document.getElementById('winner-text');
            const winnerCloseBtn = document.getElementById('winner-close-btn');
            const winnerHideBtn = document.getElementById('winner-hide-btn');

            // --- ИЗМЕНЕНИЕ: Создание пула звуков ---
            const tickSoundTemplate = document.getElementById('tick-sound-template');
            const POOL_SIZE = 5; // Количество копий звука
            const tickSoundPool = [];
            for (let i = 0; i < POOL_SIZE; i++) {
                tickSoundPool.push(tickSoundTemplate.cloneNode());
            }
            let poolIndex = 0;
            // --- КОНЕЦ ИЗМЕНЕНИЯ ---

            let prizes = [];
            let currentRotation = 0;
            let isSpinning = false;
            let lastWinnerRawText = null;
            let winnerBannerTimeout;
            
            const colorPalette = ["#98FB98", "#F5DEB3", "#ADD8E6", "#FFB6C1", "#E6E6FA", "#FAFAD2"];
            const SPIN_DURATION = 7000;

            const easeOutCubic = t => 1 - Math.pow(1 - t, 4);

            function parsePrizes(text) {
                return text.split('\n').map(line => {
                    const trimmedLine = line.trim();
                    const isActive = !trimmedLine.endsWith('.');
                    const prizeText = isActive ? line : line.trim().slice(0, -1);
                    return { rawText: line, text: prizeText, active: isActive };
                }).filter(p => p.text.trim() !== '');
            }

            function syncDisplay() {
                const cleanText = prizeInput.value
                    .split('\n')
                    .map(line => line.trim().endsWith('.') ? line.trim().slice(0, -1) : line)
                    .join('\n');
                prizeDisplay.textContent = cleanText;
            }

            function updateWheel() {
                const inputText = prizeInput.value;
                prizes = parsePrizes(inputText);
                syncDisplay();

                const numSectors = prizes.length;
                if (numSectors === 0) {
                    wheel.style.background = '#f0f0f0'; 
                    wheelLabels.innerHTML = '';
                    return;
                }
                
                const sectorAngle = 360 / numSectors;

                const baseFontSize = 35; 
                const minFontSize = 12;
                const dynamicFontSize = Math.max(minFontSize, baseFontSize / Math.sqrt(numSectors));

                let gradientString = 'conic-gradient(';
                prizes.forEach((p, i) => {
                    const color = colorPalette[i % colorPalette.length];
                    gradientString += `${color} ${i*sectorAngle}deg ${(i+1)*sectorAngle}deg, `;
                });
                wheel.style.background = gradientString.slice(0, -2) + ')';
                
                wheelLabels.innerHTML = '';
                prizes.forEach((prize, index) => {
                    const label = document.createElement('span');
                    label.textContent = prize.text;
                    label.style.fontSize = `${dynamicFontSize}px`;

                    const labelAngleRad = ((index * sectorAngle) + (sectorAngle / 2) - 90) * (Math.PI / 180);
                    const textRadius = wheel.offsetWidth / 2 * 0.65; 
                    const x = textRadius * Math.cos(labelAngleRad);
                    const y = textRadius * Math.sin(labelAngleRad);
                    const textRotation = (index * sectorAngle) + (sectorAngle / 2);
                    
                    label.style.transform = `translate(-50%, -50%) translate(${x}px, ${y}px) rotate(${textRotation}deg)`;
                    label.dataset.index = index;
                    wheelLabels.appendChild(label);
                });
            }

            function animateSpin(startRotation, endRotation) {
                let startTime = null;
                let lastSegment = -1;
                const numSectors = prizes.length;
                const sectorAngle = 360 / numSectors;

                function step(timestamp) {
                    if (!startTime) startTime = timestamp;
                    const progress = timestamp - startTime;
                    const timeFraction = Math.min(progress / SPIN_DURATION, 1);
                    const easedFraction = easeOutCubic(timeFraction);

                    const rotation = startRotation + (endRotation - startRotation) * easedFraction;
                    
                    wheel.style.transform = `rotate(${rotation}deg)`;
                    wheelLabels.style.transform = `rotate(${rotation}deg)`;
                    
                    const normalizedRotation = (rotation % 360 + 360) % 360;
                    const currentAngle = 360 - normalizedRotation + 90;
                    const currentSegment = Math.floor((currentAngle % 360) / sectorAngle);

                    if (currentSegment !== lastSegment) {
                        // --- ИЗМЕНЕНИЕ: Проигрывание звука из пула ---
                        const soundToPlay = tickSoundPool[poolIndex];
                        soundToPlay.currentTime = 0;
                        soundToPlay.play().catch(e => {});
                        poolIndex = (poolIndex + 1) % POOL_SIZE; // Переходим к следующему звуку в пуле
                        // --- КОНЕЦ ИЗМЕНЕНИЯ ---
                        lastSegment = currentSegment;
                    }
                    
                    if (progress < SPIN_DURATION) {
                        requestAnimationFrame(step);
                    } else {
                        onSpinEnd(endRotation);
                    }
                }
                requestAnimationFrame(step);
            }

            function spinWheel() {
                const activePrizes = prizes.filter(p => p.active);
                if (isSpinning || activePrizes.length === 0) return;
                
                isSpinning = true;
                lastWinnerRawText = null;
                hideWinnerBanner();

                document.querySelectorAll('.wheel-labels span').forEach(span => {
                    span.classList.remove('winner-highlight');
                });

                const winningPrize = activePrizes[Math.floor(Math.random() * activePrizes.length)];
                lastWinnerRawText = winningPrize.rawText;
                const originalIndex = prizes.findIndex(p => p.rawText === winningPrize.rawText);

                const numSectors = prizes.length;
                const sectorAngle = 360 / numSectors;
                
                const randomAngleInSector = Math.random() * sectorAngle;
                const winningAngle = (originalIndex * sectorAngle) + randomAngleInSector;
                const targetAngle = 90 - winningAngle;

                const baseRotations = 6;
                const totalRotations = baseRotations * 360;
                
                const startRotation = currentRotation;
                const endRotation = (startRotation - (startRotation % 360)) + totalRotations + targetAngle;

                animateSpin(startRotation, endRotation);
            }

            function onSpinEnd(finalRotation) {
                isSpinning = false;
                
                // ИСПРАВЛЕНИЕ ЗДЕСЬ: Добавляем .pause() для надежности
                winSound.pause();
                winSound.currentTime = 0;
                winSound.play().catch(e => console.log("Звук не может быть воспроизведен автоматически."));

                currentRotation = finalRotation % 360;
                
                const winningPrize = prizes.find(p => p.rawText === lastWinnerRawText);
                const originalIndex = prizes.findIndex(p => p.rawText === winningPrize.rawText);

                const winnerLabel = document.querySelector(`.wheel-labels span[data-index="${originalIndex}"]`);
                if (winnerLabel) {
                    winnerLabel.classList.add('winner-highlight');
                }
                showWinnerBanner(winningPrize.text);
            }

            function showWinnerBanner(prizeText) {
                clearTimeout(winnerBannerTimeout);
                winnerText.textContent = prizeText;
                winnerBanner.classList.add('show');
                winnerBannerTimeout = setTimeout(hideWinnerBanner, 3000);
            }

            function hideWinnerBanner() {
                clearTimeout(winnerBannerTimeout);
                winnerBanner.classList.remove('show');
            }

            startBtn.addEventListener('click', spinWheel);
            resetBtn.addEventListener('click', () => {
                prizeInput.value = '';
                updateWheel();
                hideWinnerBanner();
            });
            prizeInput.addEventListener('input', updateWheel); 
            window.addEventListener('resize', updateWheel);
            
            prizeInput.addEventListener('focus', () => prizeDisplay.style.display = 'none');
            prizeInput.addEventListener('blur', () => {
                prizeDisplay.style.display = 'block';
                syncDisplay();
            });

            winnerCloseBtn.addEventListener('click', hideWinnerBanner);
            winnerHideBtn.addEventListener('click', () => {
                if (lastWinnerRawText) {
                    const lines = prizeInput.value.split('\n');
                    const winnerLineIndex = lines.findIndex(line => line.trim() === lastWinnerRawText.trim());
                    
                    if (winnerLineIndex !== -1 && !lines[winnerLineIndex].trim().endsWith('.')) {
                        lines[winnerLineIndex] += '.';
                        prizeInput.value = lines.join('\n');
                        updateWheel();
                        lastWinnerRawText = null; 
                    }
                }
                hideWinnerBanner();
            });

            document.addEventListener('keydown', (e) => {
                if (e.target === prizeInput && !['Space', 'KeyR', 'KeyF'].includes(e.code)) return;

                switch (e.code) {
                    case 'Space': e.preventDefault(); spinWheel(); break;
                    case 'KeyR': e.preventDefault(); resetBtn.click(); break;
                    case 'KeyE': e.preventDefault(); prizeInput.focus(); break;
                    case 'KeyF':
                        e.preventDefault();
                        if (!document.fullscreenElement) {
                            document.documentElement.requestFullscreen();
                        } else {
                            document.exitFullscreen();
                        }
                        break;
                    case 'KeyX':
                        e.preventDefault();
                        if (winnerBanner.classList.contains('show')) {
                            hideWinnerBanner();
                        } else {
                            bannersSection.classList.toggle('hidden');
                        }
                        break;
                    case 'KeyS':
                        e.preventDefault();
                        if (winnerBanner.classList.contains('show') && lastWinnerRawText && !isSpinning) {
                             winnerHideBtn.click();
                        }
                        break;
                }
            });

            updateWheel();
        });
    </script>
</body>
</html>
